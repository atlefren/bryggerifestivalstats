<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" media="all" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <style type="text/css">
        .map {
            width: 100%;
            height: 300px;

        }
    </style>
</head>
<body>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <h1>Bryggerifestivalen i Trondheim</h1>
                <p>Basert på statistikk fra Untappd</p>
            </div>
        </div>
        <div class="row">
        {% for year in years %}
            <div class="col-md-{{12 // years | length}}">
                <h2>{{year.year}}</h2>
                <dl>
                    <dt>Antall innsjekkinger:</dt>
                    <dd>{{year.num_checkins}}</dd>
                    <dt>Antall forskjellige øl:</dt>
                    <dd>{{year.num_beers}}</dd>
                    <dt>Mest innsjekkede øl:</dt>
                    <dd>
                        <ol>
                            {% for beer in year.beer_top_5 %}
                            <li>
                                <a href="https://untappd.com/beer/{{beer.bid}}" target="_blank">
                                    {{beer.brewery.brewery_name}} {{beer.beer_name}}
                                </a>
                                ({{beer.num}})
                            </li>
                            {% endfor %}
                        </ol>
                    </dd>
                    <dt>Høyest ratede øl*:</dt>
                    <dd>
                        <ol>
                            {% for beer in year.beer_top_5_score %}
                            <li>
                                <a href="https://untappd.com/beer/{{beer.bid}}" target="_blank">
                                    {{beer.brewery.brewery_name}} {{beer.beer_name}}
                                </a>
                                ({{beer.score |round(2)}} / 5) ({{beer.num}} checkins)
                            </li>
                            {% endfor %}
                        </ol>
                        <p>*Øl med minst 2 checkins, snitt av alle ratinger på festivalen</p>
                    </dd>
                    <dt>Antall forskjellige bryggerier:</dt>
                    <dd>{{year.num_breweries}}</dd>
                    <dt>Mest innsjekkede bryggerier:</dt>
                    <dd>
                        <ol>
                            {% for brewery in year.brewery_top_5 %}
                                <li>
                                    <a href="https://untappd.com/brewery/{{brewery.brewery_id}}" target="_blank">
                                        {{brewery.brewery_name}}
                                    </a>
                                    ({{brewery.num}})
                                </li>
                            {% endfor %}
                        </ol>
                    </dd>
                    <dt>Antall forskjellige brukere:</dt>
                    <dd>{{year.num_users}}</dd>
                    <dt>Brukere med flest innsjekkinger:</dt>
                    <dd>
                        <ol>
                            {% for user in year.user_top_5 %}
                            <li>
                                <a href="https://untappd.com/user/{{user.user_name}}" target="_blank">
                                    {{user.user_name}}
                                </a>
                                ({{user.num}})
                            </li>
                            {% endfor %}
                        </ol>
                    </dd>
                </dl>

                <h4>Bilder</h4>
                {% for photo in year.photos %}
                    <img src="{{photo}}" height="100" width="100" />
                {% endfor %}

                <h4>Bryggerikart</h4>
                <div id="map-{{year.year}}" class="map"></div>

                <script type="text/javascript">
                    (function () {
                        var positions = {{year.pos}};
                        var map = L.map('map-{{year.year}}');
                        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
                        }).addTo(map);

                        var features = L.geoJson(positions, {
                            onEachFeature: function (feature, layer) {
                                layer.bindPopup(feature.properties.name);
                            }
                        });

                        map.fitBounds(features.getBounds());
                        features.addTo(map);
                    }());


                </script>

            </div>
        {% endfor %}
        </div>
    </div>
</body>
</html>
